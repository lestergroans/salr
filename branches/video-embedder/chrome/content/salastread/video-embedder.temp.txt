function VideoEmbedder(doc) {
	
	this._UVIDEO_WIDTH = 450;
	this._UVIDEO_HEIGHT = 370;
	
	this._GVIDEO_WIDTH = 450;
	this._GVIDEO_HEIGHT = 370;
		
	this.doc = doc;
	
	this.run = function() {
		
		//var links = document.evaluate('//a[starts-with(@href, "http")]', document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
		//var forumidnodes = selectNodes(doc, doc.getElementById("container"), "DIV[@class='breadcrumbs']/SPAN/B/A[contains(@href,'forumdisplay.php')][contains(@href,'forumid=')]");
		var links = selectNodes(doc, doc, '//a[starts-with(@href, "http")]');
		
		for (var i=0; i<links.length; i++)
		{
			var thisLink = links[i];

			var href = thisLink.href;
			var hrefmatch = href.match(/^http\:\/\/(www\.)?youtube\.com\/watch\?v=([-_0-9a-zA-Z]+)/);
			if (hrefmatch)
			{
				var vidid = hrefmatch[2];
				this.prepareVideoPlayer(thisLink, vidid);
			}
			else
			{
				var ghrefmatch = href.match(/^http\:\/\/video\.google\.com\/videoplay\?docid=([-0-9]+)/);
				if (ghrefmatch)
				{
					var gvidid = ghrefmatch[1];
					this.prepareGoogleVideoPlayer(thisLink, gvidid);
				}
			}
		}
	}

	this.prepareVideoPlayer = function(linkNode, videoId) {
		var obj = this;
		linkNode.style.backgroundColor = "#ffcccc !important";
		linkNode.vidid = videoId;
		linkNode.addEventListener('click', function(e) { obj.vidClick(e, e.target, videoId); }, false);
	}

	this.prepareGoogleVideoPlayer = function(linkNode, videoId) {
		var obj = this;
		linkNode.style.backgroundColor = "#ffcccc !important";
		linkNode.vidid = videoId;
		linkNode.addEventListener('click', function(e) { obj.vidGoogleClick(e, e.target, videoId); }, false);
	}

	this.vidClick = function(e, linkNode, videoId) {
			
		var embedEl = document.createElement("EMBED");
		embedEl.setAttribute('width', this._UVIDEO_WIDTH);
		embedEl.setAttribute('height', this._UVIDEO_HEIGHT);
		embedEl.setAttribute('quality',"high");
		embedEl.setAttribute('bgcolor',"#FFFFFF");
		embedEl.setAttribute('type', "application/x-shockwave-flash");
		embedEl.setAttribute('wmode', "transparent");
		embedEl.setAttribute('src', "http://www.youtube.com/v/" + videoId);
			
		linkNode.parentNode.insertBefore(embedEl, linkNode);
		this.insertRemoveLink(linkNode, embedEl);
		linkNode.parentNode.removeChild(linkNode);
		
		e.preventDefault();

		return;
	}
	
	this.vidGoogleClick = function(e, linkNode, videoId) {
		var embedEl = document.createElement("EMBED");
		embedEl.setAttribute('width', this._GVIDEO_WIDTH);
		embedEl.setAttribute('height', this._GVIDEO_HEIGHT);
		embedEl.setAttribute('type', 'application/x-shockwave-flash');
		embedEl.setAttribute('flashvars', '');
		embedEl.setAttribute('src', 'http://video.google.com/googleplayer.swf?docId=' + videoId + '&hl=en');

		linkNode.parentNode.insertBefore(embedEl, linkNode);
		this.insertRemoveLink(linkNode, embedEl);
		linkNode.parentNode.removeChild(linkNode);
		
		e.preventDefault();

		return;
	}

	this.insertRemoveLink = function(linkNode, embedEl) {
		
		var obj = this;
		var aEl = document.createElement("A");
		aEl.href = document.location.href;
		aEl.appendChild(document.createTextNode("[hide]"));
		aEl.addEventListener('click', function(e) { obj.processRemoveLink(e, linkNode, embedEl); }, false);
		embedEl.parentNode.insertBefore(aEl, embedEl);
		
	}
	
	this.processRemoveLink = function(e, linkNode, embedEl) {
		//this is the onclick handler for the remove link
		
		var targetEl = e.target;
		embedEl.parentNode.insertBefore(linkNode, embedEl);
		embedEl.parentNode.removeChild(embedEl);
		targetEl.parentNode.removeChild(targetEl);
		e.preventDefault();
		return false;
		
	}
	
}